<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Benfei VCF ‚Äî Admin Page</title>
  <style>
    body{
      margin:0; font-family:system-ui,Arial,sans-serif;
      background:#0a0f0a; color:#e7ffe7; padding:20px;
    }
    h1{
      color:#39ff14; text-align:center; margin-bottom:20px;
    }
    table{
      width:100%; border-collapse:collapse; margin-top:20px;
      background:#0f1610; border:1px solid #173a19;
      border-radius:12px; overflow:hidden;
    }
    th,td{
      padding:10px; text-align:left;
      border-bottom:1px solid #173a19;
    }
    th{
      background:#173a19; color:#b6ffb6;
    }
    tr:hover{background:#112011}
    .empty{
      margin-top:20px; text-align:center; color:#aaa;
    }
    button{
      background:#18d36a; border:none; padding:8px 12px;
      border-radius:6px; color:#02240f; font-weight:600; cursor:pointer;
      margin:2px;
    }
    button:hover{filter:brightness(1.1)}
    .danger{background:#ff5f5f; color:#fff;}
    .edit{background:#ffa500; color:#fff;}
  </style>
</head>
<body>
  <h1>üìã Admin ‚Äî Benfei VCF Contacts</h1>
  
  <button onclick="clearContacts()">üóëÔ∏è Clear All Contacts</button>
  <button onclick="downloadVCF()">‚¨áÔ∏è Download VCF</button>
  
  <div id="tableWrapper"></div>

  <script>
    const KEY = "benfei_contacts";

    function readContacts(){
      try { return JSON.parse(localStorage.getItem(KEY) || "[]"); }
      catch { return []; }
    }

    function saveContacts(list){
      localStorage.setItem(KEY, JSON.stringify(list));
    }

    function renderTable(){
      const contacts = readContacts();
      const wrapper = document.getElementById("tableWrapper");
      if(contacts.length === 0){
        wrapper.innerHTML = "<p class='empty'>No contacts uploaded yet.</p>";
        return;
      }
      let html = "<table><thead><tr><th>#</th><th>Full Name</th><th>Phone</th><th>Uploaded At</th><th>Actions</th></tr></thead><tbody>";
      contacts.forEach((c,i)=>{
        const date = new Date(c.ts).toLocaleString();
        html += `
          <tr>
            <td>${i+1}</td>
            <td>${c.name} (RXP)</td>
            <td>${c.phone}</td>
            <td>${date}</td>
            <td>
              <button class="edit" onclick="editContact(${i})">‚úèÔ∏è Edit</button>
              <button class="danger" onclick="deleteContact(${i})">üóëÔ∏è Delete</button>
            </td>
          </tr>`;
      });
      html += "</tbody></table>";
      wrapper.innerHTML = html;
    }

    function clearContacts(){
      if(confirm("Are you sure you want to delete all contacts?")){
        localStorage.removeItem(KEY);
        renderTable();
      }
    }

    function deleteContact(index){
      let contacts = readContacts();
      if(confirm(`Delete contact: ${contacts[index].name}?`)){
        contacts.splice(index,1);
        saveContacts(contacts);
        renderTable();
      }
    }

    function editContact(index){
      let contacts = readContacts();
      const contact = contacts[index];
      const newName = prompt("Edit Name:", contact.name);
      if(newName === null) return; // cancel
      const newPhone = prompt("Edit Phone:", contact.phone);
      if(newPhone === null) return;

      if(newName.trim() && /^\+?[0-9]{6,15}$/.test(newPhone.trim())){
        contacts[index].name = newName.trim();
        contacts[index].phone = newPhone.trim();
        saveContacts(contacts);
        renderTable();
      } else {
        alert("‚ùå Invalid name or phone format.");
      }
    }

    function downloadVCF(){
      const contacts = readContacts();
      if(contacts.length === 0){
        alert("No contacts to export."); return;
      }
      let vcf = "";
      contacts.forEach(c=>{
        const fullName = c.name + " RXP";
        vcf += "BEGIN:VCARD\n";
        vcf += "VERSION:3.0\n";
        vcf += `FN:${fullName}\n`;
        vcf += `TEL;TYPE=CELL:${c.phone}\n`;
        vcf += "END:VCARD\n";
      });

      const blob = new Blob([vcf], {type: "text/vcard"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "contacts.vcf";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    renderTable();
  </script>
</body>
</html>
